// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Thing {
  id                String       @id
  tenantId          String
  title             String
  types             String[]
  description       Json
  publicDescription Json
  source            String?
  publicForms       PublicForm[]
  credentials       Credential[]
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@unique([tenantId, id])
}

model DiscoveredThing {
  id          String   @id
  tenantId    String
  title       String
  types       String[]
  description Json
  source      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([tenantId, id])
}

model PublicForm {
  thingId      String
  tenantId     String
  type         String
  name         String
  index        Int
  description  Json
  uriVariables Json?
  source       String?
  security     String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  thing Thing @relation(fields: [thingId, tenantId], references: [id, tenantId], onDelete: Cascade)

  @@id([thingId, tenantId, type, name, index])
}

model Credential {
  tenantId String
  thingId  String
  data     Json

  thing Thing @relation(fields: [thingId, tenantId], references: [id, tenantId], onDelete: Cascade)

  @@id([tenantId, thingId])
}

model PluginSettings {
  name     String
  tenantId String
  settings Json

  @@id([name, tenantId])
}
